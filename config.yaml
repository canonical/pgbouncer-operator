# Copyright 2022 Canonical Ltd.
# See LICENSE file for licensing details.

options:
  pool_mode:
    default: session
    description: |
      Specifies when a server connection can be reused by other clients. Can
      be one of the following values:

      session
      Server is released back to pool after client disconnects. Default.

      transaction
      Server is released back to pool after transaction finishes.

      statement
      Server is released back to pool after query finishes. Transactions
      spanning multiple statements are disallowed in this mode.
    type: string

  max_db_connections:
    default: 0
    description: |
      Do not allow more than this many server connections per database
      (regardless of user). This considers the PgBouncer database that the
      client has connected to, not the PostgreSQL database of the outgoing
      connection.

      Note that when you hit the limit, closing a client connection to one pool
      will not immediately allow a server connection to be established for
      another pool, because the server connection for the first pool is still
      open. Once the server connection closes (due to idle timeout), a new
      server connection will immediately be opened for the waiting pool.

      0 = unlimited
    type: int
